#! /usr/bin/env bash

redis-cli del z:routvalues
calcrouts=$(redis-cli get calcrouts)

redis-cli EVALSHA $calcrouts 1 z:routvalues $1
bigzs=$(redis-cli get bigzs)
varyzs=$(redis-cli get varyzs)
avgzsv=$(redis-cli get avgzsv)

for ((i =0; i < $1; i++)) do
routV=$(redis-cli -h redis-6379.homelab.local -p 6379 zrange z:routvalues ${i} ${i})
echo $routV
echo redis-cli EVALSHA $bigzs 1 z:ss1{$routV} 20000
redis-cli EVALSHA $bigzs 1 z:ss1{$routV} 20000
echo redis-cli EVALSHA $varyzs 1 z:{$routV} 2000 50
redis-cli EVALSHA $varyzs 1 z:{$routV} 2000 50
oput=$(redis-cli -r 1 -i 1 EVALSHA $avgzsv 1 z:{$routV}:PURCH:${i+1})
echo $oput
echo redis-cli -r 3 -i 1 EVALSHA $avgzsv 1 z:{$routV}:PURCH:${i+1}
redis-cli EVALSHA $avgzsv 1 z:{$routV}:PURCH:${i+10}
done
