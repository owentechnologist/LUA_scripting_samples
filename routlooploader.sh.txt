#! /usr/bin/env bash

redis-cli -h redis-6379.homelab.local -p 6379 del z:routvalues
calcrouts=$(redis-cli -h redis-6379.homelab.local -p 6379 get calcrouts)

redis-cli -h redis-6379.homelab.local -p 6379 EVALSHA $calcrouts 1 z:routvalues $1
bigzs=$(redis-cli -h redis-6379.homelab.local -p 6379 get bigzs)
varyzs=$(redis-cli -h redis-6379.homelab.local -p 6379 get varyzs)
avgzsv=$(redis-cli -h redis-6379.homelab.local -p 6379 get avgzsv)

for ((i =0; i < $1; i++)) do
routV=$(redis-cli -h redis-6379.homelab.local -p 6379 zrange z:routvalues ${i} ${i})
echo $routV
echo redis-cli -h redis-6379.homelab.local -p 6379 EVALSHA $bigzs 1 z:ss1{$routV} 20000
redis-cli -h redis-6379.homelab.local -p 6379 EVALSHA $bigzs 1 z:ss1{$routV} 20000
echo redis-cli -h redis-6379.homelab.local -p 6379 EVALSHA $varyzs 1 z:{$routV} 20000 50
redis-cli -h redis-6379.homelab.local -p 6379 EVALSHA $varyzs 1 z:{$routV} 20000 50
oput=$(redis-cli -h redis-6379.homelab.local -p 6379 -r 1 -i 1 EVALSHA $avgzsv 1 z:{$routV}:PURCH:${i+1})
echo $oput
echo redis-cli -h redis-6379.homelab.local -p 6379 -r 3 -i 1 EVALSHA $avgzsv 1 z:{$routV}:PURCH:${i+1}
redis-cli -h redis-6379.homelab.local -p 6379 EVALSHA $avgzsv 1 z:{$routV}:PURCH:${i+10}
done
